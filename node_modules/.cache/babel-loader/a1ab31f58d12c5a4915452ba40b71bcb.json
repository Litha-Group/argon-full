{"ast":null,"code":"import { useRef as e, useCallback as r, useEffect as n, useState as t } from \"react\";\nimport { jsx as o } from \"react/jsx-runtime\";\n\nfunction i(t) {\n  var o = t.redirectUri,\n      i = t.clientId,\n      c = t.onSuccess,\n      a = t.onError,\n      s = t.scope,\n      d = void 0 === s ? \"r_emailaddress\" : s,\n      u = t.state,\n      l = void 0 === u ? \"\" : u,\n      w = t.closePopupMessage,\n      p = void 0 === w ? \"User closed the popup\" : w,\n      g = e(null),\n      v = e(null),\n      f = r(function (e) {\n    var r = localStorage.getItem(\"linkedin_oauth2_state\");\n    if (e.origin === window.location.origin) if (e.data.errorMessage && \"Linked In\" === e.data.from) {\n      if (e.data.state !== r) return void (g.current && g.current.close());\n      a && a(e.data), g.current && g.current.close();\n    } else if (e.data.code && \"Linked In\" === e.data.from) {\n      if (e.data.state !== r) return void (g.current && g.current.close());\n      c && c(e.data.code), g.current && g.current.close();\n    }\n  }, [a, c]);\n  n(function () {\n    return function () {\n      window.removeEventListener(\"message\", f, !1), g.current && (g.current.close(), g.current = null), v.current && (window.clearInterval(v.current), v.current = null);\n    };\n  }, [f]), n(function () {\n    return window.addEventListener(\"message\", f, !1), function () {\n      window.removeEventListener(\"message\", f, !1);\n    };\n  }, [f]);\n\n  var h = function () {\n    var e = \"&scope=\" + encodeURI(d),\n        r = l || function (e) {\n      void 0 === e && (e = 20);\n\n      for (var r = \"\", n = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\", t = n.length, o = 0; o < e; o++) r += n.charAt(Math.floor(Math.random() * t));\n\n      return r;\n    }();\n\n    return localStorage.setItem(\"linkedin_oauth2_state\", r), \"https://www.linkedin.com/oauth/v2/authorization?response_type=code&client_id=\" + i + \"&redirect_uri=\" + o + e + \"&state=\" + r;\n  };\n\n  return {\n    linkedInLogin: function () {\n      var e;\n      null === (e = g.current) || void 0 === e || e.close(), g.current = window.open(h(), \"_blank\", function (e) {\n        var r = e.width,\n            n = void 0 === r ? 600 : r,\n            t = e.height,\n            o = void 0 === t ? 600 : t;\n        return \"left=\" + (screen.width / 2 - n / 2) + \",top=\" + (screen.height / 2 - o / 2) + \",width=\" + n + \",height=\" + o;\n      }({\n        width: 600,\n        height: 600\n      })), v.current && (window.clearInterval(v.current), v.current = null), v.current = window.setInterval(function () {\n        try {\n          g.current && g.current.closed && (window.clearInterval(v.current), v.current = null, a && a({\n            error: \"user_closed_popup\",\n            errorMessage: p\n          }));\n        } catch (e) {\n          window.clearInterval(v.current), v.current = null;\n        }\n      }, 1e3);\n    }\n  };\n}\n\nfunction c(e) {\n  return (0, e.children)({\n    linkedInLogin: i({\n      redirectUri: e.redirectUri,\n      clientId: e.clientId,\n      onSuccess: e.onSuccess,\n      onError: e.onError,\n      state: e.state,\n      scope: e.scope,\n      closePopupMessage: e.closePopupMessage\n    }).linkedInLogin\n  });\n}\n\nfunction a() {\n  var e = t(\"\"),\n      r = e[0],\n      i = e[1];\n  return n(function () {\n    var e = function (e) {\n      for (var r = e.substring(1).split(\"&\"), n = {}, t = 0; t < r.length; t++) {\n        var o = r[t].split(\"=\");\n        o.length > 1 && (n[decodeURIComponent(o[0])] = decodeURIComponent(o[1]));\n      }\n\n      return n;\n    }(window.location.search);\n\n    if (e.state !== localStorage.getItem(\"linkedin_oauth2_state\")) i(\"State does not match\");else if (e.error) {\n      var r = e.error_description || \"Login failed. Please try again.\";\n      window.opener && window.opener.postMessage({\n        error: e.error,\n        state: e.state,\n        errorMessage: r,\n        from: \"Linked In\"\n      }, window.location.origin), \"user_cancelled_login\" === e.error && window.close();\n    }\n    e.code && window.opener && window.opener.postMessage({\n      code: e.code,\n      state: e.state,\n      from: \"Linked In\"\n    }, window.location.origin);\n  }, []), o(\"div\", {\n    children: r\n  }, void 0);\n}\n\nexport { c as LinkedIn, a as LinkedInCallback, i as useLinkedIn };","map":{"version":3,"mappings":"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","names":["useLinkedIn","_a","redirectUri","clientId","onSuccess","onError","_b","scope","s","_c","state","u","_d","closePopupMessage","w","popupRef","useRef","popUpIntervalRef","receiveMessage","useCallback","event","savedState","localStorage","getItem","origin","window","location","data","errorMessage","from","current","close","code","useEffect","removeEventListener","clearInterval","addEventListener","getUrl","scopeParam","encodeURI","generatedState","length","result","characters","charactersLength","i","charAt","Math","floor","random","generateRandomString","setItem","linkedInLogin","open","width","r","height","t","screen","getPopupPositionProperties","setInterval","closed","error","LinkedIn","children","LinkedInCallback","useState","setErrorMessage","params","search","vars","substring","split","parsed","pair","decodeURIComponent","parse","errorMessage_1","error_description","opener","postMessage","_jsx"],"sources":["../src/useLinkedIn.tsx","../src/utils.ts","../src/LinkedIn.tsx","../src/LinkedInCallback.tsx"],"sourcesContent":["import { useCallback, useEffect, useRef } from 'react';\nimport { useLinkedInType } from './types';\nimport { LINKEDIN_OAUTH2_STATE } from './utils';\n\nconst getPopupPositionProperties = ({ width = 600, height = 600 }) => {\n  const left = screen.width / 2 - width / 2;\n  const top = screen.height / 2 - height / 2;\n  return `left=${left},top=${top},width=${width},height=${height}`;\n};\n\nconst generateRandomString = (length = 20) => {\n  let result = '';\n  const characters =\n    'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  const charactersLength = characters.length;\n  for (let i = 0; i < length; i++) {\n    result += characters.charAt(Math.floor(Math.random() * charactersLength));\n  }\n  return result;\n};\n\nexport function useLinkedIn({\n  redirectUri,\n  clientId,\n  onSuccess,\n  onError,\n  scope = 'r_emailaddress',\n  state = '',\n  closePopupMessage = 'User closed the popup',\n}: useLinkedInType) {\n  const popupRef = useRef<Window>(null);\n  const popUpIntervalRef = useRef<number>(null);\n\n  const receiveMessage = useCallback(\n    (event: MessageEvent) => {\n      const savedState = localStorage.getItem(LINKEDIN_OAUTH2_STATE);\n      if (event.origin === window.location.origin) {\n        if (event.data.errorMessage && event.data.from === 'Linked In') {\n          // Prevent CSRF attack by testing state\n          if (event.data.state !== savedState) {\n            popupRef.current && popupRef.current.close();\n            return;\n          }\n          onError && onError(event.data);\n          popupRef.current && popupRef.current.close();\n        } else if (event.data.code && event.data.from === 'Linked In') {\n          // Prevent CSRF attack by testing state\n          if (event.data.state !== savedState) {\n            console.error('State does not match');\n            popupRef.current && popupRef.current.close();\n            return;\n          }\n          onSuccess && onSuccess(event.data.code);\n          popupRef.current && popupRef.current.close();\n        }\n      }\n    },\n    [onError, onSuccess],\n  );\n\n  useEffect(() => {\n    return () => {\n      window.removeEventListener('message', receiveMessage, false);\n\n      if (popupRef.current) {\n        popupRef.current.close();\n        popupRef.current = null;\n      }\n      if (popUpIntervalRef.current) {\n        window.clearInterval(popUpIntervalRef.current);\n        popUpIntervalRef.current = null;\n      }\n    };\n  }, [receiveMessage]);\n\n  useEffect(() => {\n    window.addEventListener('message', receiveMessage, false);\n    return () => {\n      window.removeEventListener('message', receiveMessage, false);\n    };\n  }, [receiveMessage]);\n\n  const getUrl = () => {\n    const scopeParam = `&scope=${encodeURI(scope)}`;\n    const generatedState = state || generateRandomString();\n    localStorage.setItem(LINKEDIN_OAUTH2_STATE, generatedState);\n    const linkedInAuthLink = `https://www.linkedin.com/oauth/v2/authorization?response_type=code&client_id=${clientId}&redirect_uri=${redirectUri}${scopeParam}&state=${generatedState}`;\n    return linkedInAuthLink;\n  };\n\n  const linkedInLogin = () => {\n    popupRef.current?.close();\n    popupRef.current = window.open(\n      getUrl(),\n      '_blank',\n      getPopupPositionProperties({ width: 600, height: 600 }),\n    );\n\n    if (popUpIntervalRef.current) {\n      window.clearInterval(popUpIntervalRef.current);\n      popUpIntervalRef.current = null;\n    }\n    popUpIntervalRef.current = window.setInterval(() => {\n      try {\n        if (popupRef.current && popupRef.current.closed) {\n          window.clearInterval(popUpIntervalRef.current);\n          popUpIntervalRef.current = null;\n          if (onError) {\n            onError({\n              error: 'user_closed_popup',\n              errorMessage: closePopupMessage,\n            });\n          }\n        }\n      } catch (error) {\n        console.error(error);\n        window.clearInterval(popUpIntervalRef.current);\n        popUpIntervalRef.current = null;\n      }\n    }, 1000);\n  };\n\n  return {\n    linkedInLogin,\n  };\n}\n","export const LINKEDIN_OAUTH2_STATE = 'linkedin_oauth2_state';\n\nexport function parse(search) {\n  const query = search.substring(1);\n  const vars = query.split('&');\n  const parsed = {};\n  for (let i = 0; i < vars.length; i++) {\n    const pair = vars[i].split('=');\n    if (pair.length > 1) {\n      parsed[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1]);\n    }\n  }\n  return parsed;\n}\n","import { LinkedInType } from './types';\nimport { useLinkedIn } from './useLinkedIn';\n\nexport function LinkedIn({\n  children,\n  redirectUri,\n  clientId,\n  onSuccess,\n  onError,\n  state,\n  scope,\n  closePopupMessage,\n}: LinkedInType) {\n  const { linkedInLogin } = useLinkedIn({\n    redirectUri,\n    clientId,\n    onSuccess,\n    onError,\n    state,\n    scope,\n    closePopupMessage,\n  });\n  return children({ linkedInLogin });\n}\n","import { useEffect, useState } from 'react';\nimport { LINKEDIN_OAUTH2_STATE, parse } from './utils';\n\ntype ParamsType = {\n  state: string;\n  code?: string;\n  error?: string;\n  error_description?: string;\n};\n\nexport function LinkedInCallback() {\n  const [errorMessage, setErrorMessage] = useState<string>('');\n  useEffect(() => {\n    const params = parse(window.location.search) as ParamsType;\n    if (params.state !== localStorage.getItem(LINKEDIN_OAUTH2_STATE)) {\n      setErrorMessage('State does not match');\n    } else if (params.error) {\n      const errorMessage =\n        params.error_description || 'Login failed. Please try again.';\n      window.opener &&\n        window.opener.postMessage(\n          {\n            error: params.error,\n            state: params.state,\n            errorMessage,\n            from: 'Linked In',\n          },\n          window.location.origin,\n        );\n      // Close tab if user cancelled login\n      if (params.error === 'user_cancelled_login') {\n        window.close();\n      }\n    }\n    if (params.code) {\n      window.opener &&\n        window.opener.postMessage(\n          { code: params.code, state: params.state, from: 'Linked In' },\n          window.location.origin,\n        );\n    }\n  }, []);\n\n  return <div>{errorMessage}</div>;\n}\n"]},"metadata":{},"sourceType":"module"}